<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"liyun-zhang.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.17.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Sequential Execution  Processing model  What does processing model do? How does iterator model execute? How does materialization model execute? How does vectorization model execute?   Access methods">
<meta property="og:type" content="article">
<meta property="og:title" content="07 Query Execution">
<meta property="og:url" content="http://liyun-zhang.github.io/2023/07/12/Courses/15445/07-Query-Execution/index.html">
<meta property="og:site_name" content="LiyunZhang">
<meta property="og:description" content="Sequential Execution  Processing model  What does processing model do? How does iterator model execute? How does materialization model execute? How does vectorization model execute?   Access methods">
<meta property="og:locale">
<meta property="article:published_time" content="2023-07-12T08:51:12.000Z">
<meta property="article:modified_time" content="2023-09-26T06:00:41.047Z">
<meta property="article:author" content="LiyunZhang">
<meta property="article:tag" content="Database System">
<meta property="article:tag" content="Executor">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://liyun-zhang.github.io/2023/07/12/Courses/15445/07-Query-Execution/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-Hans","comments":true,"permalink":"http://liyun-zhang.github.io/2023/07/12/Courses/15445/07-Query-Execution/","path":"2023/07/12/Courses/15445/07-Query-Execution/","title":"07 Query Execution"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>07 Query Execution | LiyunZhang</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">LiyunZhang</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#sequential-execution"><span class="nav-number">1.</span> <span class="nav-text"> Sequential Execution</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#processing-model"><span class="nav-number">1.1.</span> <span class="nav-text"> Processing model</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#what-does-processing-model-do"><span class="nav-number">1.1.1.</span> <span class="nav-text"> What does processing model do?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#how-does-iterator-model-execute"><span class="nav-number">1.1.2.</span> <span class="nav-text"> How does iterator model execute?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#how-does-materialization-model-execute"><span class="nav-number">1.1.3.</span> <span class="nav-text"> How does materialization model execute?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#how-does-vectorization-model-execute"><span class="nav-number">1.1.4.</span> <span class="nav-text"> How does vectorization model execute?</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#access-methods"><span class="nav-number">1.2.</span> <span class="nav-text"> Access methods</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#how-can-we-optimize-sequential-scan-with-data-skipping"><span class="nav-number">1.2.1.</span> <span class="nav-text"> How can we optimize sequential scan with data skipping?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#what-is-multi-index-scan"><span class="nav-number">1.2.2.</span> <span class="nav-text"> What is multi-index scan?</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#modification-queries"><span class="nav-number">1.3.</span> <span class="nav-text"> Modification queries</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#how-should-we-execute-update-and-delete-queries"><span class="nav-number">1.3.1.</span> <span class="nav-text"> How should we execute update and delete queries?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#how-should-we-execute-insert-queries"><span class="nav-number">1.3.2.</span> <span class="nav-text"> How should we execute insert queries?</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#how-to-evaluate-expressions"><span class="nav-number">1.4.</span> <span class="nav-text"> How to evaluate expressions?</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#parallel-execution"><span class="nav-number">2.</span> <span class="nav-text"> Parallel execution</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#parallel-and-distributed"><span class="nav-number">2.1.</span> <span class="nav-text"> Parallel and distributed</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#why-care-about-parallel-execution"><span class="nav-number">2.1.1.</span> <span class="nav-text"> Why care about parallel execution?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#what-are-the-similarities-and-differences-between-parallel-and-distributed-dbms"><span class="nav-number">2.1.2.</span> <span class="nav-text"> What are the similarities and differences between parallel and distributed DBMS?</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#process-model"><span class="nav-number">2.2.</span> <span class="nav-text"> Process model</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#what-does-process-model-of-parallel-dbmss-need-to-do"><span class="nav-number">2.2.1.</span> <span class="nav-text"> What does process model of parallel DBMSs need to do?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#what-is-process-per-worker-model"><span class="nav-number">2.2.2.</span> <span class="nav-text"> What is process per worker model?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#what-is-thread-per-worker-model"><span class="nav-number">2.2.3.</span> <span class="nav-text"> What is thread per worker model?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#what-is-considered-when-dbms-scheduling-threads"><span class="nav-number">2.2.4.</span> <span class="nav-text"> What is considered when DBMS scheduling threads?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#what-is-embedded-dbms-model"><span class="nav-number">2.2.5.</span> <span class="nav-text"> What is embedded DBMS model?</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#query-level-parallelism"><span class="nav-number">2.3.</span> <span class="nav-text"> Query-level parallelism</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#what-are-the-query-level-parallelisms"><span class="nav-number">2.3.1.</span> <span class="nav-text"> What are the query-level parallelisms?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#how-can-we-achieve-intra-query-parallelism"><span class="nav-number">2.3.2.</span> <span class="nav-text"> How can we achieve intra-query parallelism?</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#io-paralleism"><span class="nav-number">2.4.</span> <span class="nav-text"> I&#x2F;O paralleism</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#what-is-the-problem-of-query-level-parallelism"><span class="nav-number">2.4.1.</span> <span class="nav-text"> What is the problem of query-level parallelism?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#how-can-we-parallel-ios-with-multi-disk"><span class="nav-number">2.4.2.</span> <span class="nav-text"> How can we parallel I&#x2F;Os with multi-disk?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#how-can-we-partition-database"><span class="nav-number">2.4.3.</span> <span class="nav-text"> How can we partition database?</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">LiyunZhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">42</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">

  
  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://liyun-zhang.github.io/2023/07/12/Courses/15445/07-Query-Execution/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiyunZhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LiyunZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="07 Query Execution | LiyunZhang">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          07 Query Execution
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-07-12 16:51:12" itemprop="dateCreated datePublished" datetime="2023-07-12T16:51:12+08:00">2023-07-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-09-26 14:00:41" itemprop="dateModified" datetime="2023-09-26T14:00:41+08:00">2023-09-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Open-Courses/" itemprop="url" rel="index"><span itemprop="name">Open Courses</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Open-Courses/CMU-15-445-645-Database-System/" itemprop="url" rel="index"><span itemprop="name">CMU 15-445/645 Database System</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p><ul class="markdownIt-TOC">
<li><a href="#sequential-execution">Sequential Execution</a>
<ul>
<li><a href="#processing-model">Processing model</a>
<ul>
<li><a href="#what-does-processing-model-do">What does processing model do?</a></li>
<li><a href="#how-does-iterator-model-execute">How does iterator model execute?</a></li>
<li><a href="#how-does-materialization-model-execute">How does materialization model execute?</a></li>
<li><a href="#how-does-vectorization-model-execute">How does vectorization model execute?</a></li>
</ul>
</li>
<li><a href="#access-methods">Access methods</a>
<ul>
<li><a href="#how-can-we-optimize-sequential-scan-with-data-skipping">How can we optimize sequential scan with data skipping?</a></li>
<li><a href="#what-is-multi-index-scan">What is multi-index scan?</a></li>
</ul>
</li>
<li><a href="#modification-queries">Modification queries</a>
<ul>
<li><a href="#how-should-we-execute-update-and-delete-queries">How should we execute update and delete queries?</a></li>
<li><a href="#how-should-we-execute-insert-queries">How should we execute insert queries?</a></li>
</ul>
</li>
<li><a href="#how-to-evaluate-expressions">How to evaluate expressions?</a></li>
</ul>
</li>
<li><a href="#parallel-execution">Parallel execution</a>
<ul>
<li><a href="#parallel-and-distributed">Parallel and distributed</a>
<ul>
<li><a href="#why-care-about-parallel-execution">Why care about parallel execution?</a></li>
<li><a href="#what-are-the-similarities-and-differences-between-parallel-and-distributed-dbms">What are the similarities and differences between parallel and distributed DBMS?</a></li>
</ul>
</li>
<li><a href="#process-model">Process model</a>
<ul>
<li><a href="#what-does-process-model-of-parallel-dbmss-need-to-do">What does process model of parallel DBMSs need to do?</a></li>
<li><a href="#what-is-process-per-worker-model">What is process per worker model?</a></li>
<li><a href="#what-is-thread-per-worker-model">What is thread per worker model?</a></li>
<li><a href="#what-is-considered-when-dbms-scheduling-threads">What is considered when DBMS scheduling threads?</a></li>
<li><a href="#what-is-embedded-dbms-model">What is embedded DBMS model?</a></li>
</ul>
</li>
<li><a href="#query-level-parallelism">Query-level parallelism</a>
<ul>
<li><a href="#what-are-the-query-level-parallelisms">What are the query-level parallelisms?</a></li>
<li><a href="#how-can-we-achieve-intra-query-parallelism">How can we achieve intra-query parallelism?</a></li>
</ul>
</li>
<li><a href="#io-paralleism">I/O paralleism</a>
<ul>
<li><a href="#what-is-the-problem-of-query-level-parallelism">What is the problem of query-level parallelism?</a></li>
<li><a href="#how-can-we-parallel-ios-with-multi-disk">How can we parallel I/Os with multi-disk?</a></li>
<li><a href="#how-can-we-partition-database">How can we partition database?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</p>
<h1 id="sequential-execution"><a class="markdownIt-Anchor" href="#sequential-execution"></a> Sequential Execution</h1>
<h2 id="processing-model"><a class="markdownIt-Anchor" href="#processing-model"></a> Processing model</h2>
<h3 id="what-does-processing-model-do"><a class="markdownIt-Anchor" href="#what-does-processing-model-do"></a> What does processing model do?</h3>
<ol>
<li>Processing model defines how the system executes a query plan, i.e. how to traverse the query plan tree.</li>
<li>There are two processing directions:
<ul>
<li>Top-to-Bottom: Start with the root and “pull” data up from its children. Tuples are always passed with function calls.</li>
<li>Bottom-to-Top: Start with leaf nodes and push data to their parents. Allows for tighter control of caches/registers in pipelines.</li>
</ul>
</li>
<li>There are three commonly used model: iterator model (volcano/pipeline model), materialization model and vectorized/batch model.</li>
</ol>
<h3 id="how-does-iterator-model-execute"><a class="markdownIt-Anchor" href="#how-does-iterator-model-execute"></a> How does iterator model execute?</h3>
<ol>
<li>
<p>In iterator model, operators are executed top-to-down.</p>
</li>
<li>
<p>Each query plan operator implements a <code>Next()</code> function. On each invocation, the operator returns either a single tuple or a <code>null</code> marker if there are no more tuples.</p>
<ul>
<li>
<p>The operator implements a loop that calls <code>Next()</code> on its children to retrieve their tuples and then process them.</p>
</li>
<li>
<p><code>Next()</code> is first called on the root operator and the nodes on the tree will call the <code>Next()</code> on their children recursively.</p>
</li>
</ul>
</li>
<li>
<p>This model allows for uple pipelining. Although some operators must block until their children emit all their tuples.</p>
<ul>
<li>Joins must wait until all tuples in the leaf child are processed and built the hash table to further process tuples from right child. Hence, the tuples from leaft child need to block the pipeline while the tuples from right child can enable pipeline.</li>
<li>Subqueries and ordering (<code>Order By</code>) clauses also need to block pipeline. These are called pipeline breaker.</li>
</ul>
</li>
<li>
<p>Output control works easily with this approach. We only need to add constraints on the root operator.</p>
</li>
</ol>
<h3 id="how-does-materialization-model-execute"><a class="markdownIt-Anchor" href="#how-does-materialization-model-execute"></a> How does materialization model execute?</h3>
<ol>
<li>
<p>In materialization model, operators are called bottom-to-up.</p>
</li>
<li>
<p>Each query plan operator implements a <code>Output()</code> function.</p>
<ul>
<li>
<p>On each invocation, the operator processes its input all at once and then emits its output all at once.</p>
</li>
<li>
<p>The operator materializes its output as a single result.</p>
</li>
<li>
<p>The operators can send either a materialized row or a single column.</p>
</li>
</ul>
</li>
<li>
<p>The DBMS can push down hints (e.g., <code>LIMIT</code>) to avoid scanning too many tuples.</p>
</li>
<li>
<p>The output can be either whole tuples (NSM) or subsets of columns (DSM).</p>
</li>
<li>
<p>This model is better for OLTP workloads because queries only access a small number of tuples at a time which means lower execution and coordination overhead and fewer function calls.</p>
<ul>
<li>It is not good for OLAP queries with large intermediate results.</li>
</ul>
</li>
</ol>
<h3 id="how-does-vectorization-model-execute"><a class="markdownIt-Anchor" href="#how-does-vectorization-model-execute"></a> How does vectorization model execute?</h3>
<ol>
<li>The problem of iterator model is that it can only process one tuple at a time when we can take multiple tuples and vectorize them to process in parallel (SIMD).</li>
<li>Vectorization model is similar with iterator model except that each operator emits a batch of tuples instead of a single tuple.</li>
<li>This is ideal for OLAP queries because it greatly reduces the number of invocations per operator.
<ul>
<li>It allows for operators to more easily use vectorized (SIMD) instructions to process batches of tuples.</li>
</ul>
</li>
</ol>
<h2 id="access-methods"><a class="markdownIt-Anchor" href="#access-methods"></a> Access methods</h2>
<h3 id="how-can-we-optimize-sequential-scan-with-data-skipping"><a class="markdownIt-Anchor" href="#how-can-we-optimize-sequential-scan-with-data-skipping"></a> How can we optimize sequential scan with data skipping?</h3>
<ol>
<li>
<p>The first approach is approximate queries.</p>
<ul>
<li>
<p>This method is lossy, which means that it may return incorrect results, but it is OK.</p>
</li>
<li>
<p>Execute queries on a sampled subset of the entire table to produce approximate results.</p>
</li>
</ul>
</li>
<li>
<p>The second approach is zone maps.</p>
<ul>
<li>This method is lossless.</li>
<li>Pre-computed aggregates for the attribute values in a page. DBMS checks the zone map first to decide whether it wants to access the page.</li>
<li>The trade-off is between page size and filter efficacy.</li>
</ul>
</li>
</ol>
<h3 id="what-is-multi-index-scan"><a class="markdownIt-Anchor" href="#what-is-multi-index-scan"></a> What is multi-index scan?</h3>
<ol>
<li>If there are multiple indexes that the DBMS can use for a query, one method for DBMS to execute is try to filter tuples with index that has least number of tuples matches and filter other indexes based on the filtered tuples of previous indexes.
<ul>
<li>This is ideal in the case that some indexes has little tuples that matches. Filtering those indexes first can significantly reduce the number of tuples to process in following indexes.</li>
</ul>
</li>
<li>If all indexes has a lot of matching tuples, we can use another method:
<ul>
<li>Compute sets of Record IDs using each matching index. Combine these sets based on the query’s predicates (union or intersect). Retrieve the records and apply any remaining predicates.</li>
<li>In this way, we can reduce a log of I/O and memory space by only fetching Record IDs in the first phase instead of fetching entire tuple.</li>
</ul>
</li>
</ol>
<h2 id="modification-queries"><a class="markdownIt-Anchor" href="#modification-queries"></a> Modification queries</h2>
<h3 id="how-should-we-execute-update-and-delete-queries"><a class="markdownIt-Anchor" href="#how-should-we-execute-update-and-delete-queries"></a> How should we execute update and delete queries?</h3>
<ol>
<li>Operators that modify the database (<code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>) are responsible for modifying the target table and its indexes.
<ul>
<li>The output of these operators can either be Record Ids or tuple data (i.e., <code>RETURNING</code>).</li>
</ul>
</li>
<li>For update or delete, child operators pass Record IDs for target tuples.
<ul>
<li>The operator should remove the corresponding item from index.</li>
<li>Then the operator can modify tuple or remove tuple.</li>
<li>Update should re-insert modified tuple into index again.</li>
</ul>
</li>
<li>Updates have a possible Halloween problem:
<ul>
<li>When we re-inserted the modified tuple, its new place may be ahead of cursor, i.e. we will pass the new tuple again in the future.
<ul>
<li>E.g. when the index is sorted according to an attribute, and the modification increases that attribute.</li>
</ul>
</li>
<li>An update operation changes the physical location of a tuple, which causes a scan operator to visit the tuple multiple times. It can occur on clustered tables or index scans.</li>
<li>The solution is to keep track of previously seen tuples (e.g. through Record IDs).</li>
</ul>
</li>
</ol>
<h3 id="how-should-we-execute-insert-queries"><a class="markdownIt-Anchor" href="#how-should-we-execute-insert-queries"></a> How should we execute insert queries?</h3>
<ol>
<li>The first choice is to materialize tuples inside of the operator.
<ul>
<li>The insert operator needs to implement its own method of how to materialize tuples.</li>
</ul>
</li>
<li>The second choice is that operator inserts any tuple passed in from child operators.
<ul>
<li>The insert operator only need to accept tuples from its children instead of implementing itself.</li>
</ul>
</li>
</ol>
<h2 id="how-to-evaluate-expressions"><a class="markdownIt-Anchor" href="#how-to-evaluate-expressions"></a> How to evaluate expressions?</h2>
<ol>
<li>The DBMS represents a <code>WHERE</code> clause as an expression tree.</li>
<li>The nodes in the tree represent different expression types: Comparisons (<code>=, &lt;, &gt;, !=</code>), conjunction (<code>AND</code>), disjunction (<code>OR</code>), arithmetic operators (<code>+, -, *, /, %</code>), constant values, tuple attribute references.</li>
<li>When evaluate the expression, DFS through the expression tree from the root.
<ul>
<li>The performance is poor due to that the DBMS traverses the tree and for each node that it visits it must figure out what the operator needs to do.</li>
</ul>
</li>
<li>A better approach is to just evaluate the expression directly.
<ul>
<li>Compile a function of the express (e.g. JIT compilation). In evaluation, DBMS just execute the compiled function instead of traversing through the tree.</li>
</ul>
</li>
</ol>
<h1 id="parallel-execution"><a class="markdownIt-Anchor" href="#parallel-execution"></a> Parallel execution</h1>
<h2 id="parallel-and-distributed"><a class="markdownIt-Anchor" href="#parallel-and-distributed"></a> Parallel and distributed</h2>
<h3 id="why-care-about-parallel-execution"><a class="markdownIt-Anchor" href="#why-care-about-parallel-execution"></a> Why care about parallel execution?</h3>
<ol>
<li>It increased performance for potentially the same hardware resources, i.e. to gain higher throughput and lower latency.</li>
<li>It increased the responsiveness of the system.</li>
<li>It potentially lower total cost of ownership (TCO).
<ul>
<li>Fewer machines means less parts / physical footprint / energy consumption.</li>
</ul>
</li>
</ol>
<h3 id="what-are-the-similarities-and-differences-between-parallel-and-distributed-dbms"><a class="markdownIt-Anchor" href="#what-are-the-similarities-and-differences-between-parallel-and-distributed-dbms"></a> What are the similarities and differences between parallel and distributed DBMS?</h3>
<ol>
<li>Similarities:
<ul>
<li>Database is spread out across multiple resources to improve different aspects of the DBMS.</li>
<li>They both need to make database  to appear as a single logical database instance to the application, regardless of physical organization.</li>
<li>SQL query for a single-resource DBMS should generate same result on a parallel or distributed DBMS.</li>
</ul>
</li>
<li>Differences:
<ul>
<li>For parallel DBMSs, resources are physically close to each other. Hence resources communicate over high-speed interconnect. And communication is assumed to be cheap and reliable.</li>
<li>For distributed DBMSs, resources can be far from each other. Resources communicate using slow(er) interconnect. Therefore, communication cost and problems cannot be ignored. And communication is considered unreliable.</li>
</ul>
</li>
</ol>
<h2 id="process-model"><a class="markdownIt-Anchor" href="#process-model"></a> Process model</h2>
<h3 id="what-does-process-model-of-parallel-dbmss-need-to-do"><a class="markdownIt-Anchor" href="#what-does-process-model-of-parallel-dbmss-need-to-do"></a> What does process model of parallel DBMSs need to do?</h3>
<ol>
<li>It defines how the system is architected to support concurrent requests from a multi-user application.</li>
<li>A worker is the DBMS component that is responsible for executing tasks on behalf of the client and returning the results.</li>
<li>There are three approaches: process per DBMS worker, thread per DBMS worker and embedded DBMS</li>
</ol>
<h3 id="what-is-process-per-worker-model"><a class="markdownIt-Anchor" href="#what-is-process-per-worker-model"></a> What is process per worker model?</h3>
<ol>
<li>Each worker is a separate OS process. Hence, this model relies on OS scheduler entirely.</li>
<li>When an application connect with DBMS, it connect with a dispatcher process. The dispatcher picks on the processes for the application. Then the application communicate with the process directly.</li>
<li>The processes can use shared-memory for global data structures.</li>
<li>The advantage of this model is that a process crash does not take down entire system.</li>
</ol>
<h3 id="what-is-thread-per-worker-model"><a class="markdownIt-Anchor" href="#what-is-thread-per-worker-model"></a> What is thread per worker model?</h3>
<ol>
<li>In this model, the whole DBMS is a single process with multiple worker threads.</li>
<li>DBMS (mostly) manages its own scheduling by controlling what each threads is doing.
<ul>
<li>This also means less overhead per context switch and that DBMS does not have to manage shared memory.</li>
</ul>
</li>
<li>There may or may not have a dispatcher thread in the front.
<ul>
<li>Applications may connect to dispatcher, and dispatcher immediately forward request to another thread while application does not know about it.</li>
<li>Or applications can use the same scheme as process per worker model.</li>
</ul>
</li>
<li>In this model, thread crash may kill the entire system.</li>
</ol>
<h3 id="what-is-considered-when-dbms-scheduling-threads"><a class="markdownIt-Anchor" href="#what-is-considered-when-dbms-scheduling-threads"></a> What is considered when DBMS scheduling threads?</h3>
<p>For each query plan, the DBMS decides where, when, and how to execute it.</p>
<ol>
<li>How many tasks should it use?</li>
<li>How many CPU cores should it use?</li>
<li>What CPU core should the tasks execute on?</li>
<li>Where should a task store its output?</li>
</ol>
<h3 id="what-is-embedded-dbms-model"><a class="markdownIt-Anchor" href="#what-is-embedded-dbms-model"></a> What is embedded DBMS model?</h3>
<ol>
<li>In aforementioned systems and most common systems, applications are in separate machines. They are connected through TCP or socket. Even if the applications crashed, DBMS still remains running.</li>
<li>In embedded DBMS, DBMS runs inside of the same address space as the application. Application is (mostly) responsible for threads and scheduling.</li>
<li>The application may support outside connections.</li>
</ol>
<h2 id="query-level-parallelism"><a class="markdownIt-Anchor" href="#query-level-parallelism"></a> Query-level parallelism</h2>
<h3 id="what-are-the-query-level-parallelisms"><a class="markdownIt-Anchor" href="#what-are-the-query-level-parallelisms"></a> What are the query-level parallelisms?</h3>
<ol>
<li>Inter-Query: Execute multiple disparate queries simultaneously.
<ul>
<li>This parallelism increases throughput and reduces latency. It improves overall performance by allowing multiple queries to execute simultaneously.</li>
<li>If queries are read-only, then this requires almost no explicit coordination between queries. Buffer pool can handle most of the sharing if necessary.</li>
<li>If multiple queries are updating the database at the same time, then this is hard to do correctly.</li>
</ul>
</li>
<li>Intra-Query: Execute the operations of a single query in parallel.
<ul>
<li>This parallelism decreases latency for long-running queries, especially for OLAP queries. It improves the performance of a single query by executing its operators in parallel.</li>
<li>Organize operators in terms of a producer/consumer paradigm.</li>
</ul>
</li>
</ol>
<h3 id="how-can-we-achieve-intra-query-parallelism"><a class="markdownIt-Anchor" href="#how-can-we-achieve-intra-query-parallelism"></a> How can we achieve intra-query parallelism?</h3>
<ol>
<li>The first approach is using intra-operator (horizontal) parallelism.
<ul>
<li>Decompose operators into independent fragments that perform the same function on different subsets of data.</li>
<li>In the generated query plan, those decomposed operators are copied for each thread.</li>
<li>The DBMS inserts an exchange operator into the query plan to coalesce/split results from multiple children/parent operators. The exchange operators are similar with barriers stating that data cannot be sent up to parent until received all results.</li>
<li>There are three kinds of exchange operators:
<ul>
<li>Gather: Combine the results from multiple workers into a single output stream.</li>
<li>Distribute: Split a single input stream into multiple output streams.</li>
<li>Repartition: Shuffle multiple input streams across multiple output streams.</li>
</ul>
</li>
</ul>
</li>
<li>The second approach is using inter-operator (vertical / pipeline) parallelism.
<ul>
<li>Operations are overlapped in order to pipeline data from one stage to the next without materialization.</li>
<li>Each operator is a worker. Workers execute operators from different segments of a query plan at the same time.</li>
</ul>
</li>
<li>We can also combine these two approaches, which is call bushy parallelism.</li>
</ol>
<h2 id="io-paralleism"><a class="markdownIt-Anchor" href="#io-paralleism"></a> I/O paralleism</h2>
<h3 id="what-is-the-problem-of-query-level-parallelism"><a class="markdownIt-Anchor" href="#what-is-the-problem-of-query-level-parallelism"></a> What is the problem of query-level parallelism?</h3>
<ol>
<li>Using additional processes/threads to execute queries in parallel won’t help if the disk is always the main bottleneck.</li>
<li>It can sometimes make the DBMS’s performance worse if worker is accessing different segments of the disk at the same time.</li>
</ol>
<h3 id="how-can-we-parallel-ios-with-multi-disk"><a class="markdownIt-Anchor" href="#how-can-we-parallel-ios-with-multi-disk"></a> How can we parallel I/Os with multi-disk?</h3>
<ol>
<li>
<p>Split the DBMS across multiple storage devices to improve disk bandwidth latency.</p>
<ul>
<li>There are many options
<ul>
<li>Multiple disks per database, one database per disk, one relation per disk, split relation across multiple disks.</li>
<li>The main trade-off is the number of disks and I/O parallelism.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Configure OS/hardware to store the DBMS’s files across multiple storage<br />
devices, e.g. storage appliances, RAID configuration.</p>
<ul>
<li>
<p>This is transparent to the DBMS.</p>
</li>
<li>
<p>RAID 0 strips data into different disks. Each disk stores different data.</p>
</li>
<li>
<p>RAID 1 mirrors data in different disks. Each disk stores the same data.</p>
</li>
</ul>
</li>
</ol>
<h3 id="how-can-we-partition-database"><a class="markdownIt-Anchor" href="#how-can-we-partition-database"></a> How can we partition database?</h3>
<ol>
<li>Some DBMSs allow you to specify the disk location of each individual database.
<ul>
<li>The buffer pool manager maps a page to a disk location.</li>
<li>This is also easy to do at the filesystem level if the DBMS stores each database in a separate directory.</li>
<li>The DBMS recovery log file might still be shared if transactions can update multiple databases.</li>
</ul>
</li>
<li>Logical splitting is to split single logical table into disjoint physical segments that are stored/managed separately.
<ul>
<li>Partitioning should (ideally) be transparent to the application.</li>
<li>The application should only access logical tables and not have to worry about how things are physically stored.</li>
</ul>
</li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Database-System/" rel="tag"><i class="fa fa-tag"></i> Database System</a>
              <a href="/tags/Executor/" rel="tag"><i class="fa fa-tag"></i> Executor</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/07/07/OpenSource/BusTub/Project-2-B-Tree/" rel="prev" title="Project #2: B+Tree">
                  <i class="fa fa-chevron-left"></i> Project #2: B+Tree
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/07/15/Courses/15445/08-Query-Planning-Optimization/" rel="next" title="08 Query Planning & Optimization">
                  08 Query Planning & Optimization <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LiyunZhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css" integrity="sha256-hLTCMFlKxdNgPXyWlSSxYN0ykJmxxq9Yt3MNfdRGWeA=" crossorigin="anonymous">



</body>
</html>
