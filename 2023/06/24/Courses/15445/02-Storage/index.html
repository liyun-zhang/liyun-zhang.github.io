<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"liyun-zhang.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.17.0","exturl":false,"sidebar":{"position":"right","display":"hide","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Disk-based architecture  What are the storage devices? What is disk-oriented DMBS? Why not use the OS memory mapping (virtual memory)?   Page-oriented architecture  File storage  How does DBMS store">
<meta property="og:type" content="article">
<meta property="og:title" content="02 Storage">
<meta property="og:url" content="http://liyun-zhang.github.io/2023/06/24/Courses/15445/02-Storage/index.html">
<meta property="og:site_name" content="LiyunZhang">
<meta property="og:description" content="Disk-based architecture  What are the storage devices? What is disk-oriented DMBS? Why not use the OS memory mapping (virtual memory)?   Page-oriented architecture  File storage  How does DBMS store">
<meta property="og:locale">
<meta property="og:image" content="http://liyun-zhang.github.io/imgs/15445/Storage/access_times.png">
<meta property="og:image" content="http://liyun-zhang.github.io/imgs/15445/Storage/slot-array.png">
<meta property="og:image" content="http://liyun-zhang.github.io/imgs/15445/Storage/denorm_declare.png">
<meta property="og:image" content="http://liyun-zhang.github.io/imgs/15445/Storage/denorm_diagram.png">
<meta property="article:published_time" content="2023-06-24T09:10:07.000Z">
<meta property="article:modified_time" content="2024-03-16T04:28:09.282Z">
<meta property="article:author" content="LiyunZhang">
<meta property="article:tag" content="Database System">
<meta property="article:tag" content="Storage">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://liyun-zhang.github.io/imgs/15445/Storage/access_times.png">


<link rel="canonical" href="http://liyun-zhang.github.io/2023/06/24/Courses/15445/02-Storage/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-Hans","comments":true,"permalink":"http://liyun-zhang.github.io/2023/06/24/Courses/15445/02-Storage/","path":"2023/06/24/Courses/15445/02-Storage/","title":"02 Storage"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>02 Storage | LiyunZhang</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">LiyunZhang</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#disk-based-architecture"><span class="nav-number">1.</span> <span class="nav-text"> Disk-based architecture</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#what-are-the-storage-devices"><span class="nav-number">1.1.</span> <span class="nav-text"> What are the storage devices?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#what-is-disk-oriented-dmbs"><span class="nav-number">1.2.</span> <span class="nav-text"> What is disk-oriented DMBS?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#why-not-use-the-os-memory-mapping-virtual-memory"><span class="nav-number">1.3.</span> <span class="nav-text"> Why not use the OS memory mapping (virtual memory)?</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#page-oriented-architecture"><span class="nav-number">2.</span> <span class="nav-text"> Page-oriented architecture</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#file-storage"><span class="nav-number">2.1.</span> <span class="nav-text"> File storage</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#how-does-dbms-store-files"><span class="nav-number">2.1.1.</span> <span class="nav-text"> How does DBMS store files?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#how-does-dbms-manage-pages-in-files-on-disk"><span class="nav-number">2.1.2.</span> <span class="nav-text"> How does DBMS manage pages in files on disk?</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#page-layout"><span class="nav-number">2.2.</span> <span class="nav-text"> Page layout</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#what-is-stored-on-each-page"><span class="nav-number">2.2.1.</span> <span class="nav-text"> What is stored on each page?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#how-to-organize-tuple-oriented-data"><span class="nav-number">2.2.2.</span> <span class="nav-text"> How to organize tuple-oriented data?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#how-do-we-find-the-tuple-we-need-on-a-page"><span class="nav-number">2.2.3.</span> <span class="nav-text"> How do we find the tuple we need on a page?</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tuple-layout"><span class="nav-number">2.3.</span> <span class="nav-text"> Tuple layout</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#what-is-stored-in-a-tuple"><span class="nav-number">2.3.1.</span> <span class="nav-text"> What is stored in a tuple?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#what-is-denormalized-data"><span class="nav-number">2.3.2.</span> <span class="nav-text"> What is denormalized data?</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#log-structured-storage"><span class="nav-number">3.</span> <span class="nav-text"> Log-structured storage</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#what-is-stored-in-log-structured-storage"><span class="nav-number">3.1.</span> <span class="nav-text"> What is stored in log-structured storage?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#how-to-read-in-a-log-structured-storage"><span class="nav-number">3.2.</span> <span class="nav-text"> How to read in a log-structured storage?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#how-to-solve-that-the-log-will-become-larger-and-larger"><span class="nav-number">3.3.</span> <span class="nav-text"> How to solve that the log will become larger and larger?</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#tuple-storage"><span class="nav-number">4.</span> <span class="nav-text"> Tuple storage</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#how-to-store-data-in-a-tuple"><span class="nav-number">4.1.</span> <span class="nav-text"> How to store data in a tuple?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#what-are-supported-data-types"><span class="nav-number">4.2.</span> <span class="nav-text"> What are supported data types?</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#data-storage-models"><span class="nav-number">5.</span> <span class="nav-text"> Data storage models</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#what-kind-of-database-workloads-are-there"><span class="nav-number">5.1.</span> <span class="nav-text"> What kind of database workloads are there?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#how-does-dbms-store-tuples"><span class="nav-number">5.2.</span> <span class="nav-text"> How does DBMS store tuples?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#database-compression"><span class="nav-number">5.3.</span> <span class="nav-text"> Database compression</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#why-do-we-need-database-compression-and-what-is-the-trade-off"><span class="nav-number">5.3.1.</span> <span class="nav-text"> Why do we need database compression, and what is the trade-off?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#why-can-we-compress-data"><span class="nav-number">5.3.2.</span> <span class="nav-text"> Why can we compress data?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#what-are-the-goals-of-compression"><span class="nav-number">5.3.3.</span> <span class="nav-text"> What are the goals of compression?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#what-are-the-compression-granularities"><span class="nav-number">5.3.4.</span> <span class="nav-text"> What are the compression granularities?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#what-is-naive-compression"><span class="nav-number">5.3.5.</span> <span class="nav-text"> What is naive compression?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#how-can-we-do-better-with-the-high-level-meaning-or-semantics-of-the-data"><span class="nav-number">5.3.6.</span> <span class="nav-text"> How can we do better with the high-level meaning or semantics of the data?</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">LiyunZhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">67</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">

  
  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://liyun-zhang.github.io/2023/06/24/Courses/15445/02-Storage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiyunZhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LiyunZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="02 Storage | LiyunZhang">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          02 Storage
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-06-24 17:10:07" itemprop="dateCreated datePublished" datetime="2023-06-24T17:10:07+08:00">2023-06-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-03-16 12:28:09" itemprop="dateModified" datetime="2024-03-16T12:28:09+08:00">2024-03-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Open-Courses/" itemprop="url" rel="index"><span itemprop="name">Open Courses</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Open-Courses/CMU-15-445-645-Database-System/" itemprop="url" rel="index"><span itemprop="name">CMU 15-445/645 Database System</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p><ul class="markdownIt-TOC">
<li><a href="#disk-based-architecture">Disk-based architecture</a>
<ul>
<li><a href="#what-are-the-storage-devices">What are the storage devices?</a></li>
<li><a href="#what-is-disk-oriented-dmbs">What is disk-oriented DMBS?</a></li>
<li><a href="#why-not-use-the-os-memory-mapping-virtual-memory">Why not use the OS memory mapping (virtual memory)?</a></li>
</ul>
</li>
<li><a href="#page-oriented-architecture">Page-oriented architecture</a>
<ul>
<li><a href="#file-storage">File storage</a>
<ul>
<li><a href="#how-does-dbms-store-files">How does DBMS store files?</a></li>
<li><a href="#how-does-dbms-manage-pages-in-files-on-disk">How does DBMS manage pages in files on disk?</a></li>
</ul>
</li>
<li><a href="#page-layout">Page layout</a>
<ul>
<li><a href="#what-is-stored-on-each-page">What is stored on each page?</a></li>
<li><a href="#how-to-organize-tuple-oriented-data">How to organize tuple-oriented data?</a></li>
<li><a href="#how-do-we-find-the-tuple-we-need-on-a-page">How do we find the tuple we need on a page?</a></li>
</ul>
</li>
<li><a href="#tuple-layout">Tuple layout</a>
<ul>
<li><a href="#what-is-stored-in-a-tuple">What is stored in a tuple?</a></li>
<li><a href="#what-is-denormalized-data">What is denormalized data?</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#log-structured-storage">Log-structured storage</a>
<ul>
<li><a href="#what-is-stored-in-log-structured-storage">What is stored in log-structured storage?</a></li>
<li><a href="#how-to-read-in-a-log-structured-storage">How to read in a log-structured storage?</a></li>
<li><a href="#how-to-solve-that-the-log-will-become-larger-and-larger">How to solve that the log will become larger and larger?</a></li>
</ul>
</li>
<li><a href="#tuple-storage">Tuple storage</a>
<ul>
<li><a href="#how-to-store-data-in-a-tuple">How to store data in a tuple?</a></li>
<li><a href="#what-are-supported-data-types">What are supported data types?</a></li>
</ul>
</li>
<li><a href="#data-storage-models">Data storage models</a>
<ul>
<li><a href="#what-kind-of-database-workloads-are-there">What kind of database workloads are there?</a></li>
<li><a href="#how-does-dbms-store-tuples">How does DBMS store tuples?</a></li>
<li><a href="#database-compression">Database compression</a>
<ul>
<li><a href="#why-do-we-need-database-compression-and-what-is-the-trade-off">Why do we need database compression, and what is the trade-off?</a></li>
<li><a href="#why-can-we-compress-data">Why can we compress data?</a></li>
<li><a href="#what-are-the-goals-of-compression">What are the goals of compression?</a></li>
<li><a href="#what-are-the-compression-granularities">What are the compression granularities?</a></li>
<li><a href="#what-is-naive-compression">What is naive compression?</a></li>
<li><a href="#how-can-we-do-better-with-the-high-level-meaning-or-semantics-of-the-data">How can we do better with the high-level meaning or semantics of the data?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</p>
<h1 id="disk-based-architecture"><a class="markdownIt-Anchor" href="#disk-based-architecture"></a> Disk-based architecture</h1>
<h2 id="what-are-the-storage-devices"><a class="markdownIt-Anchor" href="#what-are-the-storage-devices"></a> What are the storage devices?</h2>
<ol>
<li>The first type is volatile memory: CPU registers, CPU caches, and DRAM.
<ul>
<li>They provide random access, and they are byte-addressable.</li>
</ul>
</li>
<li>The second type is the non-volatile disks: SSD, HDD, and network storage.
<ul>
<li>They only provide sequential access.
<ul>
<li>Random access on non-volatile storage is almost always much slower than sequential access.</li>
<li>DBMS will want to maximize sequential access.</li>
</ul>
</li>
<li>They are block-addressable.</li>
</ul>
</li>
<li>The access times of each storage are as follows:<br />
<img src="/imgs/15445/Storage/access_times.png" width="50%"></li>
</ol>
<h2 id="what-is-disk-oriented-dmbs"><a class="markdownIt-Anchor" href="#what-is-disk-oriented-dmbs"></a> What is disk-oriented DMBS?</h2>
<ol>
<li>The DBMS assumes that the primary storage location of the database is on a non-volatile disk.</li>
<li>DBMS manages a buffer pool in memory where directory and data pages are stored.</li>
<li>When the execution engine asks DBMS for a certain page:
<ul>
<li>If that page is not in memory already, DBMS will look up the directory first (if also not in memory, load from disk) to find the disk position of that page.</li>
<li>Then, DBMS will load that page from the disk and return a pointer to the buffer pool to the execution engine.</li>
</ul>
</li>
</ol>
<h2 id="why-not-use-the-os-memory-mapping-virtual-memory"><a class="markdownIt-Anchor" href="#why-not-use-the-os-memory-mapping-virtual-memory"></a> Why not use the OS memory mapping (virtual memory)?</h2>
<ol>
<li>Transaction safety: OS can flush dirty pages at any time, causing dirty data to corrupt the database. OS doesn’t know anything about transactions. Hence, it doesn’t care whether writing a page to disk is safe.</li>
<li>IO stalls: When a page miss happens, the thread will be stalled, and DBMS can do nothing about it.
<ul>
<li>Allowing multiple threads to access the <code>mmap</code> files to hide page fault stalls is good enough for read-only access. But it is complicated when there are multiple writers.</li>
</ul>
</li>
<li>Error handling: Any access can cause a <code>SIGBUS</code> that the DBMS must handle. However, DBMS may isolate and handle the error only in the storage layer.</li>
<li>Performance issues: Like OS data structure contention or TLB shootdowns.</li>
<li>In conclusion, DBMS always knows better than OS. Thus, DBMS almost always wants to control things and can do a better job than the OS.
<ul>
<li>Like how to flush dirty pages to disk in the correct order, provide specialized prefetching, better buffer replacement policy, and thread/process scheduling.</li>
</ul>
</li>
</ol>
<h1 id="page-oriented-architecture"><a class="markdownIt-Anchor" href="#page-oriented-architecture"></a> Page-oriented architecture</h1>
<h2 id="file-storage"><a class="markdownIt-Anchor" href="#file-storage"></a> File storage</h2>
<h3 id="how-does-dbms-store-files"><a class="markdownIt-Anchor" href="#how-does-dbms-store-files"></a> How does DBMS store files?</h3>
<ol>
<li>The DBMS stores a database as one or more files on disk, typically in a proprietary format.</li>
<li>The storage manager is responsible for maintaining a database’s files.
<ul>
<li>It organizes the files as a collection of pages.</li>
<li>It also tracks data read/written to pages and the available space.</li>
<li>Some do their scheduling for reads and writes to improve pages’ spatial and temporal locality.</li>
</ul>
</li>
<li>A database page is a fixed-size block of data.
<ul>
<li>Most systems do not mix page types, i.e., data on a page belong to the same table.</li>
<li>Some systems require a page to be self-contained, i.e., all metadata we need to interpret the page has to be contained in the page.</li>
<li>Hardware pages and OS pages are usually <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mtext> </mtext><mi>K</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">4\ KB</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">4</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>. But database pages may be <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>512</mn><mtext> </mtext><mi>B</mi><mo>−</mo><mn>16</mn><mtext> </mtext><mi>K</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">512\ B-16\ KB</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord">5</span><span class="mord">1</span><span class="mord">2</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">6</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span> depending on DBMS and configuration.
<ul>
<li>A larger page size can increase sequential IO, issue fewer system calls, and have a smaller page table.</li>
<li>Smaller page sizes only need to maintain less memory when only a small amount of data is needed.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="how-does-dbms-manage-pages-in-files-on-disk"><a class="markdownIt-Anchor" href="#how-does-dbms-manage-pages-in-files-on-disk"></a> How does DBMS manage pages in files on disk?</h3>
<ol>
<li>There are different ways to manage: Heap File Organization, Tree File Organization, Sequential / Sorted File Organization (ISAM), or Hashing File Organization.</li>
<li>A heap file is an unordered collection of pages with tuples stored in random order.</li>
<li>The DBMS maintains a directory in special pages that track the location of data pages in the database files.
<ul>
<li>Ensure that the directory pages are in sync with the data pages.</li>
<li>The directory also records meta-data about available space: the number of free slots per page and the list of free/empty pages.</li>
</ul>
</li>
</ol>
<h2 id="page-layout"><a class="markdownIt-Anchor" href="#page-layout"></a> Page layout</h2>
<h3 id="what-is-stored-on-each-page"><a class="markdownIt-Anchor" href="#what-is-stored-on-each-page"></a> What is stored on each page?</h3>
<ol>
<li>Every page contains a header of meta-data about the page’s contents.
<ul>
<li>Page Size</li>
<li>Checksum to check whether data is corrupted.</li>
<li>The DBMS version of the creator of this page is used to provide compatibility even when the DBMS update changes the page layout. With this, the data can be corrected and re-layout when the DBMS is updated.</li>
<li>Transaction Visibility</li>
<li>Compression Information</li>
</ul>
</li>
<li>The data in a page can be organized in tuple-oriented or log-structured.</li>
</ol>
<h3 id="how-to-organize-tuple-oriented-data"><a class="markdownIt-Anchor" href="#how-to-organize-tuple-oriented-data"></a> How to organize tuple-oriented data?</h3>
<ol>
<li>A naive strategy is to store the number of tuples in the header and append a new tuple to the end.
<ul>
<li>What if we delete a tuple?
<ul>
<li>How do we know there is available space?</li>
<li>What do we do to the following tuples? Do we move them forward, or leave them there?</li>
</ul>
</li>
<li>A more severe problem is what happens if we have a variable-length attribute.
<ul>
<li>How can we know the beginning and end of a tuple?</li>
</ul>
</li>
</ul>
</li>
<li>We store a slot array at the header in the slotted pages scheme.
<ul>
<li>The slot array maps “slots” to the tuples’ starting position offsets.</li>
<li>The header keeps track of the number of used slots and the offset of the starting location of the last slot used.</li>
<li>The space used to store tuples grows from tail to head, while the slot array grows from head to tail.</li>
<li>When a tuple is deleted, we must invalidate its value in a slot array where we can know available space.
<ul>
<li>As for its following tuples, we can either leave them as-is or compact the space.</li>
<li>As modification goes in memory, and deleting usually holds a lock, compacting the space can be fast, and there is no need to inform the rest of the system.</li>
</ul>
</li>
<li>
<img src="/imgs/15445/Storage/slot-array.png" width="25%">
</li>
</ul>
</li>
</ol>
<h3 id="how-do-we-find-the-tuple-we-need-on-a-page"><a class="markdownIt-Anchor" href="#how-do-we-find-the-tuple-we-need-on-a-page"></a> How do we find the tuple we need on a page?</h3>
<ol>
<li>Each tuple is assigned a unique record identifier.</li>
<li>The most commonly used is <code>page_id + offset/slot</code>.</li>
</ol>
<h2 id="tuple-layout"><a class="markdownIt-Anchor" href="#tuple-layout"></a> Tuple layout</h2>
<h3 id="what-is-stored-in-a-tuple"><a class="markdownIt-Anchor" href="#what-is-stored-in-a-tuple"></a> What is stored in a tuple?</h3>
<ol>
<li>A tuple is essentially a sequence of bytes. It’s the job of the DBMS to interpret those bytes into attribute types and values.</li>
<li>Each tuple is prefixed with a header containing meta-data, e.g., visibility info for concurrency control, Bit Map for NULL values.
<ul>
<li>We do not need to store meta-data about the schema.</li>
</ul>
</li>
<li>Attributes are typically stored in the order you specify when creating the table.</li>
</ol>
<h3 id="what-is-denormalized-data"><a class="markdownIt-Anchor" href="#what-is-denormalized-data"></a> What is denormalized data?</h3>
<ol>
<li>DBMS can physically denormalize (pre-join) related tuples and store them together on the same page.
<ul>
<li>For two tables, one table has an attribute referenced to another table, DBMS can store the tuples and their referenced tuples in the same slot.</li>
<li>
<img src="/imgs/15445/Storage/denorm_declare.png" width="25%">
</li>
<li>
<img src="/imgs/15445/Storage/denorm_diagram.png" width="25%">
</li>
</ul>
</li>
<li>This can potentially reduce the amount of I/O for common workload patterns and make updates more expensive.</li>
</ol>
<h1 id="log-structured-storage"><a class="markdownIt-Anchor" href="#log-structured-storage"></a> Log-structured storage</h1>
<h2 id="what-is-stored-in-log-structured-storage"><a class="markdownIt-Anchor" href="#what-is-stored-in-log-structured-storage"></a> What is stored in log-structured storage?</h2>
<ol>
<li>DBMS stores log records that contain changes to tuples (PUT, DELETE).
<ul>
<li>Each log record must contain the tuple’s unique identifier. In this case, the identifier is not <code>page_id + offset/slot</code> mentioned above since the page doesn’t exist in this scheme.</li>
</ul>
</li>
<li>As the application changes the database, the DBMS appends log records to the end of the file without checking previous log records.</li>
<li>When the page gets full, the DBMS writes it out of the disk and fills the next page with records.
<ul>
<li>All on-disk pages are immutable.</li>
<li>All disk writes are sequential.</li>
</ul>
</li>
</ol>
<h2 id="how-to-read-in-a-log-structured-storage"><a class="markdownIt-Anchor" href="#how-to-read-in-a-log-structured-storage"></a> How to read in a log-structured storage?</h2>
<ol>
<li>To read a tuple with a given ID, the DBMS finds the newest log record corresponding to that ID. It needs to scan the log from newest to oldest.
<ul>
<li>DBMS can maintain an index that maps a tuple ID to the newest log record to optimize the linear scan.</li>
</ul>
</li>
<li>If the log record is in memory, just read it. If the log record is on a disk page, retrieve it.</li>
</ol>
<h2 id="how-to-solve-that-the-log-will-become-larger-and-larger"><a class="markdownIt-Anchor" href="#how-to-solve-that-the-log-will-become-larger-and-larger"></a> How to solve that the log will become larger and larger?</h2>
<ol>
<li>The DBMS can periodically compact pages to reduce wasted space.
<ul>
<li>It can take two continuous pages and scan from newest to oldest, leaving one newest log for each tuple.</li>
</ul>
</li>
<li>The DBMS can sort the page based on ID order to improve future look-up efficiency.
<ul>
<li>This sorted table is called a <strong>Sorted String Table</strong>, <strong>SSTable</strong>.</li>
<li>After a page is compacted, the DBMS does need to maintain the temporal ordering of records within the page since each tuple ID is guaranteed to appear at most once on the page.</li>
</ul>
</li>
<li>There are two strategies to choose which pages to compact:
<ul>
<li>The Universal compaction chooses any two continuous pages.</li>
<li>The level compaction chooses two continuous pages on the same level and compacts them into the next level.</li>
</ul>
</li>
<li>The downside of compaction is write-amplification caused by duplicate writing to the newest record of a tuple, and compacting itself is expensive.</li>
</ol>
<h1 id="tuple-storage"><a class="markdownIt-Anchor" href="#tuple-storage"></a> Tuple storage</h1>
<h2 id="how-to-store-data-in-a-tuple"><a class="markdownIt-Anchor" href="#how-to-store-data-in-a-tuple"></a> How to store data in a tuple?</h2>
<ol>
<li>A tuple is essentially a sequence of bytes. It’s the job of the DBMS to interpret those bytes into attribute types and values.</li>
<li>The DBMS’s catalogs contain the schema information about tables that the system uses to figure out the tuple’s layout.
<ul>
<li>A DBMS stores meta-data about databases in its internal catalogs.
<ul>
<li>Tables, columns, indexes, views</li>
<li>Users, permissions</li>
<li>Internal statistics</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="what-are-supported-data-types"><a class="markdownIt-Anchor" href="#what-are-supported-data-types"></a> What are supported data types?</h2>
<ol>
<li>The basic types are supported: <code>INTEGER</code>/<code>BIGINT</code>/<code>SMALLINT</code>/<code>TINYINT</code>, <code>FLOAT</code>/<code>REAL</code>, <code>VARCHAR</code>/<code>VARBINARY</code>/<code>TEXT</code>/<code>BLOB</code>, <code>TIME</code>/<code>DATE</code>/<code>TIMESTAMP</code>.</li>
<li>Since IEEE 754 floating points may be inaccurate, fixed-point decimals are also supported as <code>NUMERIC</code>/<code>DECIMAL</code>. But their execution is way slower than floating points.</li>
<li>Most DBMSs don’t allow a tuple to exceed the size of a single page.
<ul>
<li>The DBMS uses separate overflow storage pages to store values that are larger than a page.</li>
<li>Some systems allow you to store a large value in an external file. And treat the data as a BLOB type. Then, the DBMS cannot manipulate the contents of an external file.
<ul>
<li>No durability protections. No transaction protections.</li>
<li>They are outside of DBMS. Hence, we cannot update it through DBMS either.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h1 id="data-storage-models"><a class="markdownIt-Anchor" href="#data-storage-models"></a> Data storage models</h1>
<h2 id="what-kind-of-database-workloads-are-there"><a class="markdownIt-Anchor" href="#what-kind-of-database-workloads-are-there"></a> What kind of database workloads are there?</h2>
<ol>
<li>On-Line Transaction Processing (OLTP): In this situation, commands are fast operations that only read/update a small amount of data each time. The data accessed in a query is related to a single entity in the database.</li>
<li>On-Line Analytical Processing (OLAP): Here, commands are complex queries that read a lot of data to compute aggregates, i.e., they will execute complex writes and complex reads.</li>
<li>Hybrid Transaction + Analytical Processing: OLTP + OLAP together on the same database instance.</li>
</ol>
<h2 id="how-does-dbms-store-tuples"><a class="markdownIt-Anchor" href="#how-does-dbms-store-tuples"></a> How does DBMS store tuples?</h2>
<ol>
<li><strong>N-ary storage model</strong> (<strong>row storage</strong>): The DBMS contiguously stores all attributes for a single tuple on a page.
<ul>
<li>This model is ideal for OLTP workloads where queries operate only on an individual entity and insert-heavy workloads.</li>
<li>The advantage is fast inserts, updates, and deletes. It is also suitable for queries that need the entire tuple.</li>
<li>However, it is not good for scanning large portions of the table and a subset of the attributes.</li>
</ul>
</li>
<li><strong>Decomposition storage model</strong> (<strong>DSM</strong>, <strong>Column storage</strong>): The DBMS stores the values of a single attribute for all tuples contiguously on a page.
<ul>
<li>This model is ideal for OLAP workloads where read-only queries perform large scans over a subset of the table’s attributes.</li>
<li>DBMS can identify tuples in two choices:
<ul>
<li>The first is using fixed-length offsets when each value is the same length for an attribute. It does not require each attribute to have the same length. This is the most used scheme.</li>
<li>The second is using embedded tuple IDs. Each value is stored in a column with its tuple ID.</li>
</ul>
</li>
<li>The advantage of DSM is that it reduces the amount wasted I/O because the DBMS only reads the data it needs and provides better query processing and data compression.</li>
<li>The disadvantage is that it is slow for point queries, inserts, updates, and deletes because of tuple splitting/stitching.</li>
</ul>
</li>
</ol>
<h2 id="database-compression"><a class="markdownIt-Anchor" href="#database-compression"></a> Database compression</h2>
<h3 id="why-do-we-need-database-compression-and-what-is-the-trade-off"><a class="markdownIt-Anchor" href="#why-do-we-need-database-compression-and-what-is-the-trade-off"></a> Why do we need database compression, and what is the trade-off?</h3>
<ol>
<li>I/O is the main bottleneck if the DBMS fetches data from the disk during query execution.</li>
<li>The DBMS can compress pages to increase the utility of the data moved per I/O operation.</li>
<li>The fundamental trade-off is between speed and compression ratio.
<ul>
<li>Compressing and decompressing will take higher CPU costs to get a better compression ratio. But it can reduce DRAM requirements.</li>
<li>Some engines work with compressed data, which can reduce CPU costs.</li>
</ul>
</li>
</ol>
<h3 id="why-can-we-compress-data"><a class="markdownIt-Anchor" href="#why-can-we-compress-data"></a> Why can we compress data?</h3>
<ol>
<li>Data sets tend to have highly skewed distributions for attribute values.</li>
<li>Data sets tend to have a high correlation between attributes of the same tuple.</li>
</ol>
<h3 id="what-are-the-goals-of-compression"><a class="markdownIt-Anchor" href="#what-are-the-goals-of-compression"></a> What are the goals of compression?</h3>
<ol>
<li>It must produce fixed-length values. The only exception is var-length data stored in a separate pool.</li>
<li>Late materialization: Postpone decompression for as long as possible during query execution.</li>
<li>It must be a lossless scheme.
<ul>
<li>When a DBMS uses compression, it is always lossless because people don’t like losing data.</li>
<li>Any lossy compression must be performed at the application level.</li>
</ul>
</li>
</ol>
<h3 id="what-are-the-compression-granularities"><a class="markdownIt-Anchor" href="#what-are-the-compression-granularities"></a> What are the compression granularities?</h3>
<ol>
<li>Block-level: Compression is performed on a block of tuples for the same table.</li>
<li>Tuple-level: Compression is performed on the contents of the entire tuple (NSM-only).</li>
<li>Attribute-level: Compression is performed on a single attribute within one tuple (overflow). It can target multiple attributes for the same tuple.</li>
<li>Column-level: Compression is performed on multiple values for one or more attributes stored for multiple tuples (DSM-only).</li>
</ol>
<h3 id="what-is-naive-compression"><a class="markdownIt-Anchor" href="#what-is-naive-compression"></a> What is naive compression?</h3>
<ol>
<li>Naive means that the data system does not understand the bits after compression.</li>
<li>We can compress data using a general-purpose algorithm. The scope of compression is only based on the data provided as input.</li>
<li>In disk, each page stores the compressed data and the modification log of this page.</li>
<li>When DBMS reads a page into the buffer pool
<ul>
<li>It won’t decompress until queries need to return the whole tuple.</li>
<li>Every update will only append an entry in the mod log. Hence no need to decompress data when only updating tuples. The only thing we need to know in updating is which page this tuple is.</li>
<li>DBMS will decompress the page and apply changes when the mod log is full.</li>
</ul>
</li>
</ol>
<h3 id="how-can-we-do-better-with-the-high-level-meaning-or-semantics-of-the-data"><a class="markdownIt-Anchor" href="#how-can-we-do-better-with-the-high-level-meaning-or-semantics-of-the-data"></a> How can we do better with the high-level meaning or semantics of the data?</h3>
<ol>
<li>This is performed on the column level.</li>
<li>Run-length encoding:
<ul>
<li>Compress runs of continuous same value in a single column into triplets <code>(value, offset, length) </code>.
<ul>
<li><code>Value</code> is the value of the attribute.</li>
<li><code>Offset</code> is the start position in the column segment of the continuous save value run.</li>
<li><code>Length</code> is the number of elements in the run.</li>
</ul>
</li>
<li>It requires the columns to be sorted intelligently to maximize compression opportunities.</li>
</ul>
</li>
<li>Bit-packing encoding:
<ul>
<li>When values for an attribute are always less than the value’s declared largest size, store them as a smaller data type.</li>
<li>Mostly, encoding uses a special marker to indicate when a value exceeds the largest size and maintains a look-up table to store them.</li>
</ul>
</li>
<li>Bitmap encoding:
<ul>
<li>Store a separate bitmap for <strong>each unique value</strong> for an attribute where an offset in the vector corresponds to a tuple.</li>
<li>When reading, DBMS needs looks into the bits in the tuple to find which bit is <code>1</code> to know which value is stored in this attribute of this tuple.</li>
<li>We need to store the value for each bitmap. So, the total space required is the total length of possible values, and the number of bits is the same as the number of tuples for each value.</li>
</ul>
</li>
<li>Delta encoding:
<ul>
<li>Recording the difference between this tuple and its last tuple.</li>
<li>Store base value in-line or in a separate look-up table.</li>
<li>Combine with RLE to get even better compression ratios.</li>
</ul>
</li>
<li>Incremental encoding:
<ul>
<li>Delta encoding is for numbers, while incremental encoding is for strings.</li>
<li>It stores the length of common prefixes between this tuple and its last tuple and the extra suffixes of this tuple.</li>
<li>When there is no common prefix, the length is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>. It performed better when we sorted tuples according to the strings.</li>
</ul>
</li>
<li>Dictionary compression (most widely used):
<ul>
<li>Build a data structure that maps variable-length values to a smaller integer identifier. And replace those values with their corresponding identifier in the dictionary data structure.</li>
<li>A dictionary is required to support fast encoding, decoding, and a range of queries.</li>
<li>The hash function can not be used due to key confliction, and decoding cannot be provided.</li>
<li>When the dictionary encodes values in a certain order (e.g., alphabetic order), the execution engine can be optimized to do some queries only access the dictionary, especially for those <code>DISTINCT</code> queries.</li>
</ul>
</li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Database-System/" rel="tag"><i class="fa fa-tag"></i> Database System</a>
              <a href="/tags/Storage/" rel="tag"><i class="fa fa-tag"></i> Storage</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/06/24/Courses/15445/01-Relational-Model/" rel="prev" title="01 Relational Model">
                  <i class="fa fa-chevron-left"></i> 01 Relational Model
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/06/24/Courses/15445/03-Buffer-Pool-Manage/" rel="next" title="03 Buffer Pool Manage">
                  03 Buffer Pool Manage <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LiyunZhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css" integrity="sha256-hLTCMFlKxdNgPXyWlSSxYN0ykJmxxq9Yt3MNfdRGWeA=" crossorigin="anonymous">



</body>
</html>
