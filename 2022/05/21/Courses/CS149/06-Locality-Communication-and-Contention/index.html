<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"liyun-zhang.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.17.0","exturl":false,"sidebar":{"position":"right","display":"hide","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="CommunicationReduce communication time Total communication time &#x3D; overhead + occupancy + network delay.   Overhead is the time spent on communication by a processor, occupancy is the time for data to">
<meta property="og:type" content="article">
<meta property="og:title" content="06. Locality, Communication, and Contention">
<meta property="og:url" content="http://liyun-zhang.github.io/2022/05/21/Courses/CS149/06-Locality-Communication-and-Contention/index.html">
<meta property="og:site_name" content="LiyunZhang">
<meta property="og:description" content="CommunicationReduce communication time Total communication time &#x3D; overhead + occupancy + network delay.   Overhead is the time spent on communication by a processor, occupancy is the time for data to">
<meta property="og:locale">
<meta property="article:published_time" content="2022-05-21T05:42:23.000Z">
<meta property="article:modified_time" content="2024-03-16T11:43:13.912Z">
<meta property="article:author" content="LiyunZhang">
<meta property="article:tag" content="Parallelism">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://liyun-zhang.github.io/2022/05/21/Courses/CS149/06-Locality-Communication-and-Contention/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-Hans","comments":true,"permalink":"http://liyun-zhang.github.io/2022/05/21/Courses/CS149/06-Locality-Communication-and-Contention/","path":"2022/05/21/Courses/CS149/06-Locality-Communication-and-Contention/","title":"06. Locality, Communication, and Contention"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>06. Locality, Communication, and Contention | LiyunZhang</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">LiyunZhang</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Communication"><span class="nav-number">1.</span> <span class="nav-text">Communication</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Reduce-communication-time"><span class="nav-number">1.1.</span> <span class="nav-text">Reduce communication time</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reduce-communication-cost"><span class="nav-number">1.2.</span> <span class="nav-text">Reduce communication cost</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Improve-arithmetic-intensity"><span class="nav-number">1.3.</span> <span class="nav-text">Improve arithmetic intensity</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reduce-artifactual-communication"><span class="nav-number">1.4.</span> <span class="nav-text">Reduce artifactual communication</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Contention"><span class="nav-number">2.</span> <span class="nav-text">Contention</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Understanding-the-performance"><span class="nav-number">3.</span> <span class="nav-text">Understanding the performance</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Establish-high-watermarks"><span class="nav-number">3.1.</span> <span class="nav-text">Establish high watermarks</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Scaling"><span class="nav-number">3.2.</span> <span class="nav-text">Scaling</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">LiyunZhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">62</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">

  
  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://liyun-zhang.github.io/2022/05/21/Courses/CS149/06-Locality-Communication-and-Contention/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiyunZhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LiyunZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="06. Locality, Communication, and Contention | LiyunZhang">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          06. Locality, Communication, and Contention
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-05-21 13:42:23" itemprop="dateCreated datePublished" datetime="2022-05-21T13:42:23+08:00">2022-05-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-03-16 19:43:13" itemprop="dateModified" datetime="2024-03-16T19:43:13+08:00">2024-03-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Open-Courses/" itemprop="url" rel="index"><span itemprop="name">Open Courses</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Open-Courses/CMU-15-418-Stanford-CS149-Parallel-Computing/" itemprop="url" rel="index"><span itemprop="name">CMU 15-418 / Stanford CS149 Parallel Computing</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="Communication"><a href="#Communication" class="headerlink" title="Communication"></a>Communication</h1><h2 id="Reduce-communication-time"><a href="#Reduce-communication-time" class="headerlink" title="Reduce communication time"></a>Reduce communication time</h2><ol>
<li><p>Total communication time = overhead + occupancy + network delay. </p>
</li>
<li><p>Overhead is the time spent on communication by a processor, occupancy is the time for data to pass through the slowest component of the system, and network delay is everything else. </p>
</li>
<li><p>Reduce overhead of communication to sender/receiver:<br>Reassign tasks in a better way that needs to send fewer messages.<br>Make messages larger to amortize overhead.<br>Coalesce many small messages into large ones</p>
</li>
<li><p>Reduce delay:<br>Application writers can restructure code to exploit locality.<br>Hardware implementors can improve communication architecture. </p>
</li>
</ol>
<h2 id="Reduce-communication-cost"><a href="#Reduce-communication-cost" class="headerlink" title="Reduce communication cost"></a>Reduce communication cost</h2><ol>
<li><p>Total communication cost = communication time - overlap</p>
</li>
<li><p>Overlap: portion of communication performed concurrently with other work (“other work” can be computation or other communication)</p>
</li>
<li><p>Cost is the part you cannot overcome by changing the protocol. The communication time is necessary, and we can hide the overlap part by pipelining. </p>
</li>
<li><p>Increase communication/computation overlap:<br>Application writers can use asynchronous communication (e.g., async messages)<br>Hardware implementors can use pipelining, multi-threading, pre-fetching, out-of-order execution<br>Requires additional concurrency in the application (more concurrency than the number of execution units)</p>
</li>
<li><p>Instruction pipeline: Break the execution of each instruction down into several smaller steps.<br>Enables higher clock frequency; only a simple, short operation is done by each part of the pipeline in each clock</p>
</li>
<li><p>Non-pipelined communication: $T(n)=T_0+\frac{n}{B}$ ($T_0$ is the start-up latency, n is bytes transferred in operation, and B is the transfer rate or bandwidth)<br>Efficient bandwidth $=\frac{n}{T(n)}$</p>
</li>
</ol>
<h2 id="Improve-arithmetic-intensity"><a href="#Improve-arithmetic-intensity" class="headerlink" title="Improve arithmetic intensity"></a>Improve arithmetic intensity</h2><ol>
<li><p>Communication-to-computation ratio = amount of communication/amount of computation<br>The units can be different. If the denominator is the execution time of computation, the ratio gives the average bandwidth requirement.</p>
</li>
<li><p>Arithmetic intensity = 1 / communication-to-computation ratio</p>
</li>
<li><p>Change the traversal order to reduce the time between accesses to the same data. We want to do all the calculations related to accessing data now.<br>This way, we can improve the cache utilization by preventing those data from getting flushed out when we try to reaccess them. </p>
</li>
<li><p>Fuse loops to reduce the frequency of store operation. </p>
</li>
<li><p>Improve arithmetic intensity by sharing data. Co-locate tasks that operate on the same data.  Schedule threads to work on the same data structure and on the same processor at the same time. Reduces inherent communication</p>
</li>
</ol>
<h2 id="Reduce-artifactual-communication"><a href="#Reduce-artifactual-communication" class="headerlink" title="Reduce artifactual communication"></a>Reduce artifactual communication</h2><ol>
<li><p>Inherent communication: Communication that must occur in a parallel algorithm. The communication is fundamental to the algorithm.<br>Artifactual communication: all other communication happens because we want to use resources efficiently.</p>
</li>
<li><p>The granularity of communication can be important because it may introduce artifactual communication.<br>Assume that communication granularity is a cache line. </p>
</li>
<li><p>If we see data as a row-major layout, when the data required is in the column, each communication only provides one needed data. </p>
</li>
<li><p>When Threads access their assigned elements (no inherent communication exists), real machine triggers (artifactual) communication due to the cache line being written to by both processors. </p>
</li>
<li><p>Reduce artifactual communications by blocking data layout. Each communication only involves the data in the same block. If communication granularity is larger than a block row, each communication will transfer multiple rows. </p>
</li>
</ol>
<h1 id="Contention"><a href="#Contention" class="headerlink" title="Contention"></a>Contention</h1><ol>
<li><p>Contention occurs when many requests for a resource are made within a small window of time. The resource is a hot spot.<br>Contention of shared resources results in longer overall operation times. </p>
</li>
<li><p>Distributed work queues serve to reduce contention (contention in access to a single shared work queue)</p>
</li>
<li><p>One way to reduce contention is to use finer-granularity locks. Instead of locking the whole data structure, we can only lock a part of that structure. </p>
</li>
<li><p>Another way is that each CUDA block computes partial results and merges them afterward. However, this requires extra work for merging, and each CUDA block needs to store a partial result instead of all using the same result. </p>
</li>
<li><p>The best way is to stagger access to contended resources. For example, instead of calculating the final result directly, we can calculate several temporal results with no contention and get the final result from them. </p>
</li>
</ol>
<h1 id="Understanding-the-performance"><a href="#Understanding-the-performance" class="headerlink" title="Understanding the performance"></a>Understanding the performance</h1><ol>
<li><p>Always, always, always try the simplest parallel solution first, then measure performance to see where you stand. </p>
</li>
<li><p>We should compare parallel program speedup to the best sequential program instead of parallel algorithm running on one core.<br>The reason is that to allow for parallelism, we might change the algorithm and make it slower when executed sequentially. </p>
</li>
<li><p>Determine if your performance is limited by computation, memory bandwidth (or latency), or synchronization.<br>Try to establish “high watermarks”. What’s the best you can do in practice? How close is your implementation to a best-case scenario?</p>
</li>
<li><p>Roofline model: Use microbenchmarks to compute the peak performance of a machine as a function of the arithmetic intensity of the application. Then, compare the application’s performance to known peak values.</p>
</li>
</ol>
<h2 id="Establish-high-watermarks"><a href="#Establish-high-watermarks" class="headerlink" title="Establish high watermarks"></a>Establish high watermarks</h2><ol>
<li><p>Add “math” (non-memory instructions).<br>Does execution time increase linearly with operation count as math is added?<br>If so, this is evidence that the code is instruction-rate limited.</p>
</li>
<li><p>Remove almost all math, but load the same data.<br>How much does execution time decrease?<br>If not much, suspect memory bottleneck</p>
</li>
<li><p>Change all array accesses to A[0].<br>How much faster does your code get?<br>This establishes an upper bound for improving the locality of data access.</p>
</li>
<li><p>Remove all atomic operations or locks.<br>How much faster does your code get? (provided it still does approximately the same amount of work)<br>This establishes an upper bound on the benefit of reducing sync overhead. </p>
</li>
</ol>
<h2 id="Scaling"><a href="#Scaling" class="headerlink" title="Scaling"></a>Scaling</h2><ol>
<li><p>Both problem size and the processor’s number determine arithmetic intensity. Small problem sizes or large processor numbers yield low arithmetic intensity. </p>
</li>
<li><p>If the problem is too small, it might execute fast enough on a single core. Scaling the performance of small problems may not be all that important. </p>
</li>
<li><p>If the problem size is too large for a single machine, the working set may not fit in memory, causing thrashing to disk. With enough processors, the key working set fits in the per-processor cache.<br>This may get a super-linear speedup and make speedup on a bigger parallel machine with more memory look amazing. </p>
</li>
<li><p>Desire to scale problem size as machine sizes grow (buy a bigger machine to compute more, rather than compute the same problem faster)</p>
</li>
<li><p>Problem-constrained scaling uses a parallel computer to solve the same problem faster.<br>$Speedup=\frac{time\ 1\ processor}{time\ P\ processors}$</p>
</li>
<li><p>Time-constrained scaling focuses on completing more work in a fixed amount of time.<br>$Speedup = \frac{work\ done\ by\ P\ processors}{work\ done\ by\ 1\ processor}$<br>“Work done” may not be a linear function of problem inputs. One approach to defining “work done” is by execution time of exact computation on a single processor (but consider the effects of thrashing if the problem is too big)</p>
</li>
<li><p>Memory-constrained scaling (weak scaling) focuses on running the largest problem possible without overflowing main memory. Neither work nor execution times are held constant.<br>$Speedup = \frac{work\ (P\ processors)}{time\ (P\ processors)}/\frac{work\ (1\ processor)}{time\ (1\ processor)}=\frac{work\ per\ unit\ time\ on\ P\ processors}{work\ per\ unit\ time\ on\ 1\ processor}$</p>
</li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Parallelism/" rel="tag"><i class="fa fa-tag"></i> Parallelism</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/05/19/Courses/CS149/05-Graphic-processing-units-and-CUDA/" rel="prev" title="05. Graphic processing units and CUDA">
                  <i class="fa fa-chevron-left"></i> 05. Graphic processing units and CUDA
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/06/11/Courses/CS149/07-Workload-driven-Perfromance-Evaluation/" rel="next" title="07. Workload-driven Performance Evaluation">
                  07. Workload-driven Performance Evaluation <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LiyunZhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css" integrity="sha256-hLTCMFlKxdNgPXyWlSSxYN0ykJmxxq9Yt3MNfdRGWeA=" crossorigin="anonymous">



</body>
</html>
